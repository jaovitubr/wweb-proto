syntax = "proto3";

enum MediaVisibility {
	DEFAULT = 0;
	OFF = 1;
	ON = 2;
}

enum PrivacySystemMessage {
	E2EE_MSG = 1;
	NE2EE_SELF = 2;
	NE2EE_OTHER = 3;
}

message HistorySync {
	required HistorySyncType syncType = 1;
	repeated Conversation conversations = 2;
	repeated WebMessageInfo statusV3Messages = 3;
	uint32 chunkOrder = 5;
	uint32 progress = 6;
	repeated Pushname pushnames = 7;
	GlobalSettings globalSettings = 8;
	bytes threadIdUserSecret = 9;
	uint32 threadDsTimeframeOffset = 10;
	repeated StickerMetadata recentStickers = 11;
	repeated PastParticipants pastParticipants = 12;
	repeated CallLogRecord callLogRecords = 13;
	BotAIWaitListState aiWaitListState = 14;
	repeated PhoneNumberToLIDMapping phoneNumberToLidMappings = 15;

	enum BotAIWaitListState {
		IN_WAITLIST = 0;
		AI_AVAILABLE = 1;
	}

	enum HistorySyncType {
		INITIAL_BOOTSTRAP = 0;
		INITIAL_STATUS_V3 = 1;
		FULL = 2;
		RECENT = 3;
		PUSH_NAME = 4;
		NON_BLOCKING_DATA = 5;
		ON_DEMAND = 6;
	}
}

message Conversation {
	required string id = 1;
	repeated HistorySyncMsg messages = 2;
	string newJid = 3;
	string oldJid = 4;
	uint64 lastMsgTimestamp = 5;
	uint32 unreadCount = 6;
	bool readOnly = 7;
	bool endOfHistoryTransfer = 8;
	uint32 ephemeralExpiration = 9;
	int64 ephemeralSettingTimestamp = 10;
	EndOfHistoryTransferType endOfHistoryTransferType = 11;
	uint64 conversationTimestamp = 12;
	string name = 13;
	string pHash = 14;
	bool notSpam = 15;
	bool archived = 16;
	DisappearingMode disappearingMode = 17;
	uint32 unreadMentionCount = 18;
	bool markedAsUnread = 19;
	repeated GroupParticipant participant = 20;
	bytes tcToken = 21;
	uint64 tcTokenTimestamp = 22;
	bytes contactPrimaryIdentityKey = 23;
	uint32 pinned = 24;
	uint64 muteEndTime = 25;
	WallpaperSettings wallpaper = 26;
	MediaVisibility mediaVisibility = 27;
	uint64 tcTokenSenderTimestamp = 28;
	bool suspended = 29;
	bool terminated = 30;
	uint64 createdAt = 31;
	string createdBy = 32;
	string description = 33;
	bool support = 34;
	bool isParentGroup = 35;
	string parentGroupId = 37;
	bool isDefaultSubgroup = 36;
	string displayName = 38;
	string pnJid = 39;
	bool shareOwnPn = 40;
	bool pnhDuplicateLidThread = 41;
	string lidJid = 42;
	string username = 43;
	string lidOriginType = 44;
	uint32 commentsCount = 45;
	bool locked = 46;
	PrivacySystemMessage systemMessageToInsert = 47;

	enum EndOfHistoryTransferType {
		COMPLETE_BUT_MORE_MESSAGES_REMAIN_ON_PRIMARY = 0;
		COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY = 1;
		COMPLETE_ON_DEMAND_SYNC_BUT_MORE_MSG_REMAIN_ON_PRIMARY = 2;
	}
}

message PhoneNumberToLIDMapping {
	string pnJid = 1;
	string lidJid = 2;
}

message HistorySyncMsg {
	WebMessageInfo message = 1;
	uint64 msgOrderId = 2;
}

message Pushname {
	string id = 1;
	string pushname = 2;
}

message GroupParticipant {
	required string userJid = 1;
	Rank rank = 2;

	enum Rank {
		REGULAR = 0;
		ADMIN = 1;
		SUPERADMIN = 2;
	}
}

message WallpaperSettings {
	string filename = 1;
	uint32 opacity = 2;
}

message GlobalSettings {
	WallpaperSettings lightThemeWallpaper = 1;
	MediaVisibility mediaVisibility = 2;
	WallpaperSettings darkThemeWallpaper = 3;
	AutoDownloadSettings autoDownloadWiFi = 4;
	AutoDownloadSettings autoDownloadCellular = 5;
	AutoDownloadSettings autoDownloadRoaming = 6;
	bool showIndividualNotificationsPreview = 7;
	bool showGroupNotificationsPreview = 8;
	int32 disappearingModeDuration = 9;
	int64 disappearingModeTimestamp = 10;
	AvatarUserSettings avatarUserSettings = 11;
	int32 fontSize = 12;
	bool securityNotifications = 13;
	bool autoUnarchiveChats = 14;
	int32 videoQualityMode = 15;
	int32 photoQualityMode = 16;
	NotificationSettings individualNotificationSettings = 17;
	NotificationSettings groupNotificationSettings = 18;
	ChatLockSettings chatLockSettings = 19;
}

message AutoDownloadSettings {
	bool downloadImages = 1;
	bool downloadAudio = 2;
	bool downloadVideo = 3;
	bool downloadDocuments = 4;
}

message StickerMetadata {
	string url = 1;
	bytes fileSha256 = 2;
	bytes fileEncSha256 = 3;
	bytes mediaKey = 4;
	string mimetype = 5;
	uint32 height = 6;
	uint32 width = 7;
	string directPath = 8;
	uint64 fileLength = 9;
	float weight = 10;
	int64 lastStickerSentTs = 11;
	bool isLottie = 12;
}

message PastParticipants {
	string groupJid = 1;
	repeated PastParticipant pastParticipants = 2;
}

message PastParticipant {
	string userJid = 1;
	LeaveReason leaveReason = 2;
	uint64 leaveTs = 3;

	enum LeaveReason {
		LEFT = 0;
		REMOVED = 1;
	}
}

message AvatarUserSettings {
	string fbid = 1;
	string password = 2;
}

message NotificationSettings {
	string messageVibrate = 1;
	string messagePopup = 2;
	string messageLight = 3;
	bool lowPriorityNotifications = 4;
	bool reactionsMuted = 5;
	string callVibrate = 6;
}